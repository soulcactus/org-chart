!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.orgChart=t():e.orgChart=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return r}));n(1);class r{constructor(e){if(!e)return console.error("[OrgChart] Error: 'container' property is null. 'container' property of the OrgChart option must be set.");this.container=document.querySelector(e),this.defaultZoom=1}_checkNodeOn(e){const t=`input[name*=${Object.keys(this.profile)[0]}]`,n=document.querySelectorAll(t),r=e?e.parentElement.getAttribute("id"):null,i=e?e.nextElementSibling.getAttribute("modified"):null;let o;return!!Array.from(n).some(e=>{const t=e.getAttribute("style");return t&&(o=e),t})&&(Number(r)!==this.id&&!i&&(o.focus(),!0))}_addNode(e){console.time("addNode");const t=this.container,n=this.profile,r=this.data,i=e.target.parentElement,o=i.getAttribute("id"),d=i.parentElement.nextElementSibling,s={},a=d?d.nextElementSibling.querySelectorAll(".member"):null,l=a?Number(a[a.length-1].getAttribute("sequenceId"))+1:0;let c=this.tree,u=this.id;if(!this._checkNodeOn()){u=++this.id,s.id=u,s.parentId=Number(o),s.sequenceId=l;for(const[e,t]of Object.entries(n))s[e]=t;t.innerHTML="",r.push(s),c=this._treeModel(r),this.tree=c,this._printTree(c,t,!0),this._addEvent(),console.timeEnd("addNode")}}_removeNode(e){console.time("removeNode");const t=this.container,n=e.target.parentElement,r=Number(n.getAttribute("id")),i=Number(n.getAttribute("sequenceId")),o=n.querySelector("input").getAttribute("style"),d=this.remove,s=[],a=[],l=[];let c,u,p=this.data,m=this.tree;const h=(e,t)=>{e.forEach(e=>{const n=e.id,r=e.children;let i=e.parentId;(null!==i&&n===t||i===t)&&(s.push(n),a.push(e),i===t&&r&&h(r,e.id)),r&&h(r,t)})};if(!this._checkNodeOn(e.target)){if(function e(t,n,r=null,o=null){t.forEach(t=>{const d=t.id,s=t.parentId,f=t.sequenceId,b=t.children;if(null===s||r){if(d===n)return h(m,n)}else d===n?(c=r||s,u=o||n+Number(f),p.forEach((e,n)=>{e.id===d&&(p.splice(n,1),a.push(t))})):s===n?p.forEach(e=>{e.id===d&&(u=i+Number(f),e.parentId=c,e.sequenceId=u,l.push(e))}):c===s&&p.forEach(e=>{e.id===d&&(e.sequenceId=++u,l.push(e))}),s===n&&b&&e(b,d,d,f);b&&!r&&e(b,n)})}(m,r),s.length&&(p=p.filter(e=>!s.includes(e.id))),m=this._treeModel(p),t.innerHTML="",this.data=p,this.tree=m,this._printTree(m,t),this._addEvent(),d){if(o)return void--this.id;l.length?d([{...a},{...l}]):d({...a})}console.timeEnd("removeNode")}}_moveNode(e,t=null){console.time("moveNode");const n=this.container,r=this.data,i=this.profile,o=t?t.getAttribute("parentId"):null,d=t?Number(t.getAttribute("id")):null,s=this.move,a=[];let l,c,u,p=this.tree,m=e.target;return function e(t){if(t)return"member"!==t.className?e(t.parentElement):m=t}(m),l=m.getAttribute("id"),c=m.getAttribute("parentId"),u=function e(n){return r.some(r=>{const s=r.parentId;return!!("null"===o&&t.parentElement.parentElement.querySelector(`input[name=${Object.keys(i)[0]}${l}]`)||n===r.id&&n===d)||(n===r.id&&s?e(s):void 0)})}(Number(c)),this._checkNodeOn()||!m||l===d||c===d||u||m!==n&&"member"!==m.className?m.style.background="":(r.forEach(e=>{const t=r.filter(e=>e.parentId===Number(l)).length;e.id!==Number(l)&&e.parentId!==Number(l)&&e.id===Number(d)&&(e.parentId=Number(l),e.sequenceId=t,a.push(e),r.filter(e=>e.parentId===Number(o)).sort((e,t)=>e.sequenceId-t.sequenceId).forEach((e,t)=>{e.sequenceId!==t&&(a.push(e),e.sequenceId=t)}))}),a.length&&s({...a}),p=this._treeModel(r),n.innerHTML="",this.tree=p,this._printTree(p,n),this._addEvent(),void console.timeEnd("moveNode"))}_addEvent(){const e=document.querySelectorAll(".add-btn"),t=document.querySelectorAll(".remove-btn");document.querySelectorAll(`input[name*=${Object.keys(this.profile)[0]}]`).forEach(e=>{e.getAttribute("style")&&e.focus()}),e.forEach(e=>e.addEventListener("click",this._addNode.bind(this))),t.forEach(e=>e.addEventListener("click",this._removeNode.bind(this))),this._saveEvent(),this._modifyEvent()}_saveEvent(){const e=document.querySelectorAll(".save-btn"),t=this.profile,n=this.data;e.forEach(e=>{const r=e.parentElement.querySelectorAll("input");e.addEventListener("click",function(){const i=this.add,o=this.modify,d=Number(e.parentElement.getAttribute("id"));r.forEach(e=>{const n=e.previousElementSibling,r=e.name.replace(/[0-9]/g,"");n.textContent=e.value||t[r],n.removeAttribute("style"),e.removeAttribute("style")}),e.style.display="none",n.forEach(n=>{n.id===d&&(r.forEach(e=>{const r=e.name.replace(/[0-9]/g,"");n[r]=e.value||t[r]}),e.getAttribute("modified")&&o?o(n):i&&i(n))}),e.removeAttribute("modified")}.bind(this))})}_modifyEvent(){const e=document.querySelectorAll(".profile span");this.editable&&e.forEach(e=>{const t=e.parentElement.parentElement,n=t.parentElement.parentElement.querySelector(".save-btn");e.addEventListener("click",function(r){const i=t.querySelectorAll("span"),o=t.querySelectorAll("input");this._checkNodeOn(r.target)||(i.forEach(e=>e.style.display="none"),o.forEach(e=>{e.style.display="block",e.value=e.previousElementSibling.textContent}),e.nextElementSibling.focus(),n.style.display="block",n.setAttribute("modified",!0))}.bind(this))})}_moveEvent(){const e=this._moveNode.bind(this);let t;this.editable&&(container.addEventListener("dragstart",function(e){"move"!==container.style.cursor&&(t=e.target,e.target.style.border="1px solid red")}.bind(this)),container.addEventListener("dragend",(function(e){"move"!==container.style.cursor&&(e.target.style.border="")})),container.addEventListener("dragover",(function(e){e.preventDefault()})),container.addEventListener("dragenter",(function(e){const t=this;"move"!==container.style.cursor&&function e(n){n&&("member"!==n.className?n===t?n.style.background="red":(e(n.parentElement),t.removeAttribute("style")):n.style.background="red")}(e.target)})),container.addEventListener("dragleave",(function(e){"move"!==container.style.cursor&&("member"!==e.target.className&&e.target!==this||e.target.removeAttribute("style"))})),container.addEventListener("drop",(function(n){"move"!==container.style.cursor&&("member"!==n.target.className&&n.target!==this||n.target.removeAttribute("style"),e(n,t),container.style.cursor="default")})))}_zoomEvent(){if(this.useZoom){const e=document.querySelector(".container-wrap");this.container.style.overflow="scroll",e.style.transition="zoom 0.2s ease",e.style.zoom=this.defaultZoom,container.addEventListener("mousewheel",function(t){100===t.deltaY&&this.defaultZoom>.6?this.defaultZoom-=.05:-100===t.deltaY&&this.defaultZoom<this.zoom&&(this.defaultZoom+=.05),e.style.zoom=this.defaultZoom}.bind(this))}}_treeModel(e){const t=JSON.parse(JSON.stringify(e)),n=[],r=(e,n,i)=>{const o=n.parentId;if(e instanceof Array)return e.some(e=>{let d;return e.id===o?(e.children=e.children||[],d=e.children,d.push(t.splice(i,1)[0]),d.sort((e,t)=>e.sequenceId-t.sequenceId)):r(e.children,n,i)})};for(;t.length>0;)t.some((e,i)=>null===e.parentId?n.push(t.splice(i,1)[0]):r(n,e,i));return n}_printTree(e,t,n=!1){if(t===container){const e=document.createElement("div");e.className="container-wrap",t.appendChild(e),t=e}e.forEach((r,i)=>{const o=r.parentId,d=r.children,s=document.createElement("div"),a=document.createElement("div"),l=document.createElement("div"),c=document.createElement("div"),u=document.createElement("div"),p=document.createElement("div"),m=document.createElement("div"),h=document.createElement("ul"),f=document.createElement("button"),b=document.createElement("button"),g=document.createElement("button"),v=r.id;s.className="group-column",a.className="line-box",l.className="line",l.classList.add("border-right"),c.className="line",1!==e.length&&(0===i?c.classList.add("border-top"):i===e.length-1?l.classList.add("border-top"):(l.classList.add("border-top"),c.classList.add("border-top"))),u.className="member-box",p.className="member",p.setAttribute("id",r.id),p.setAttribute("parentId",r.parentId),p.setAttribute("sequenceId",r.sequenceId),m.className="profile-box",h.className="profile",this.editable&&(p.draggable=!0,f.className="add-btn",f.innerHTML="&#43;",b.className="remove-btn",b.innerHTML="&#45;",g.className="save-btn",g.innerHTML="&#10003;",g.style.display="none");for(const[e,t]of Object.entries(this.profile)){const i=document.createElement("li"),o=document.createElement("input"),d=document.createElement("span");if(!0===this.usePhoto&&"photo"===e){const n=document.createElement("div"),i=document.createElement("img");i.src=r[e]||t,i.draggable=!1,n.appendChild(i),m.appendChild(n)}else o.type="text",o.name=`${e}${v}`,o.placeholder=e,d.textContent=r[e]||t,n&&v===this.id&&(d.style.display="none",o.style.display="block"),i.appendChild(d),i.appendChild(o),h.appendChild(i)}if(m.appendChild(h),p.appendChild(m),this.editable&&(p.appendChild(f),p.appendChild(b),p.appendChild(g)),u.appendChild(p),a.appendChild(l),a.appendChild(c),n&&v===this.id&&(g.style.display="block"),null!==o&&s.appendChild(a),s.appendChild(u),d){const e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div");e.className="line-box",t.className="line",t.classList.add("border-right"),n.className="line",e.appendChild(t),e.appendChild(n),s.appendChild(e)}if(1===e.length)t.appendChild(s),t=s,d&&this._printTree(d,t,n);else{if(0===i){const e=document.createElement("div");e.className="group-row",e.appendChild(s),t.appendChild(e),t=e}else t.appendChild(s);d&&this._printTree(d,s,n)}}),this._zoomEvent()}draw(e,t){const n={id:0,name:"name",parentId:null,sequenceId:0},r=[],i=JSON.parse(JSON.stringify(t));let o,d=JSON.parse(JSON.stringify(e));if(d){const t=[];d=d.sort((e,t)=>e.id-t.id),d.forEach((n,i)=>{const o=n.id,d=n.parentId,s=n.sequenceId,a=e.some(e=>d===e.id);!n.hasOwnProperty("id")||!n.hasOwnProperty("parentId")||!n.hasOwnProperty("sequenceId")||"number"!=typeof o||null!==d&&"number"!=typeof d||"number"!=typeof s||Number.isNaN(o)||Number.isNaN(d)||Number.isNaN(s)||o===d||i!==e.length-1&&e[i].id===e[++i].id||null!==d&&!a?r.push(n):t.push(n)}),d=t,d.length||(d=[n])}else d=[n];e&&d.length!==e.length&&console.warn("[OrgChart] Warning: Some data items have invalid values or do not have required properties. They were excluded. You'd better check the data."),this.usePhoto=i.usePhoto,this.profile=i.profile||{name:"name"},this.useZoom=i.useZoom||!1,this.zoom=i.zoom||i.zoom>3?3:i.zoom,this.editable=i.editable||!1,this.data=d,o=this._treeModel(d),this.tree=o,this._printTree(o,container),this.id=d[d.length-1].id,this.excludedData=r,this._addEvent(),this._moveEvent()}add(e){this.add=e}remove(e){this.remove=e}modify(e){this.modify=e}move(e){this.move=e}getExcludedData(){return this.excludedData}}},function(e,t,n){(t=n(2)(!1)).push([e.i,"#container {\n    display: flex;\n    width: 1600px;\n    height: 700px;\n    margin: 100px auto 0;\n    justify-content: center;\n    border: 1px solid #ddd;\n    padding: 20px;\n    overflow: scroll;\n}\n\n.group-column {\n    display: flex;\n    flex-direction: column;\n}\n\n.group-column div {\n    margin: 0 auto;\n}\n\n.group-row {\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n}\n\n.line-box {\n    display: flex;\n    width: 100%;\n}\n\n.line {\n    width: 50%;\n    height: 20px;\n}\n\n.line.border-right {\n    border-right: 3px solid #ccc;\n}\n\n.line.border-top {\n    border-top: 3px solid #ccc;\n}\n\n.member-box {\n    width: 270px;\n    padding: 0 20px;\n}\n\n.member {\n    position: relative;\n    border: 1px solid #ccc;\n    border-radius: 5px;\n    box-sizing: border-box;\n    background: white;\n    padding: 15px;\n    text-align: center;\n    font-size: 14px;\n}\n\n.profile-box {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n}\n\n.profile-box div {\n    width: 70px;\n    height: 70px;\n    margin: 0 0 0 7px;\n    border-radius: 100%;\n    box-sizing: border-box;\n    overflow: hidden;\n}\n\n.profile-box div img {\n    width: 100%;\n    object-fit: cover;\n}\n\n.profile-box ul {\n    width: 50%;\n    text-align: left;\n}\n\n.profile-box li:not(:last-child) {\n    margin-bottom: 5px;\n}\n\n.profile-box li span {\n    word-break: break-all;\n}\n\n.profile-box li:not(:last-child) span {\n    display: block;\n    margin-bottom: 11px;\n}\n\n.profile input {\n    display: none;\n    width: 90%;\n    height: 10px;\n    border: 1px solid #ddd;\n    border-radius: 5px;\n    padding: 5px;\n}\n\n.profile input::placeholder {\n    color: #ccc;\n}\n\n.add-btn,\n.remove-btn,\n.save-btn {\n    width: 26px;\n    height: 26px;\n    position: absolute;\n    border: 1px solid #ddd;\n    border-radius: 100%;\n    background: white;\n    font-size: 18px;\n}\n\n.add-btn {\n    bottom: -13px;\n    left: calc(50% - 13px);\n}\n\n.remove-btn {\n    top: -13px;\n    left: calc(50% - 13px);\n}\n\n.save-btn {\n    top: -13px;\n    right: -13px;\n}\n",""]),e.exports=t},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var i=(d=r,s=btoa(unescape(encodeURIComponent(JSON.stringify(d)))),a="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(a," */")),o=r.sources.map((function(e){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(e," */")}));return[n].concat(o).concat([i]).join("\n")}var d,s,a;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(r)for(var o=0;o<this.length;o++){var d=this[o][0];null!=d&&(i[d]=!0)}for(var s=0;s<e.length;s++){var a=[].concat(e[s]);r&&i[a[0]]||(n&&(a[2]?a[2]="".concat(n," and ").concat(a[2]):a[2]=n),t.push(a))}},t}}])}));