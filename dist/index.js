!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["org-chart"]=t():e["org-chart"]=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return r}));class r{constructor(e){if(!e)return console.error("[OrgChart] Error: 'container' property is null. 'container' property of the OrgChart option must be set.");this.container=document.querySelector(e),this.defaultZoom=1}_checkNodeOn(e){const t=`input[name*=${Object.keys(this.profile)[0]}]`,n=document.querySelectorAll(t),r=e?e.parentElement.getAttribute("id"):null,i=e?e.nextElementSibling.getAttribute("modified"):null;let o;return!!Array.from(n).some(e=>{const t=e.getAttribute("style");return t&&(o=e),t})&&(Number(r)!==this.id&&!i&&(o.focus(),!0))}_addNode(e){const t=this.container,n=this.profile,r=this.data,i=e.target.parentElement,o=i.getAttribute("id"),s=i.parentElement.nextElementSibling,d={},l=s?s.nextElementSibling.querySelectorAll(".member"):null,a=l?Number(l[l.length-1].getAttribute("sequenceId"))+1:0;let c=this.tree,u=this.id;if(!this._checkNodeOn()){u=++this.id,d.id=u,d.parentId=Number(o),d.sequenceId=a;for(const[e,t]of Object.entries(n))d[e]=t;t.innerHTML="",r.push(d),c=this._treeModel(r),this.tree=c,this._printTree(c,t,!0),this._addEvent()}}_removeNode(e){const t=this.container,n=e.target.parentElement,r=Number(n.getAttribute("id")),i=Number(n.getAttribute("sequenceId")),o=n.querySelector("input").getAttribute("style"),s=this.remove,d=[],l=[],a=[];let c,u,m=this.data,h=this.tree;const p=(e,t)=>{e.forEach(e=>{const n=e.id,r=e.children;let i=e.parentId;(null!==i&&n===t||i===t)&&(d.push(n),l.push(e),i===t&&r&&p(r,e.id)),r&&p(r,t)})};if(!this._checkNodeOn(e.target)&&(function e(t,n,r=null,o=null){t.forEach(t=>{const s=t.id,d=t.parentId,f=t.sequenceId,b=t.children;if(null===d||r){if(s===n)return p(h,n)}else s===n?(c=r||d,u=o||n+Number(f),m.forEach((e,n)=>{e.id===s&&(m.splice(n,1),l.push(t))})):d===n?m.forEach(e=>{e.id===s&&(u=i+Number(f),e.parentId=c,e.sequenceId=u,a.push(e))}):c===d&&m.forEach(e=>{e.id===s&&(e.sequenceId=++u,a.push(e))}),d===n&&b&&e(b,s,s,f);b&&!r&&e(b,n)})}(h,r),d.length&&(m=m.filter(e=>!d.includes(e.id))),h=this._treeModel(m),t.innerHTML="",this.data=m,this.tree=h,this._printTree(h,t),this._addEvent(),s)){if(o)return void--this.id;a.length?s([{...l},{...a}]):s({...l})}}_moveNode(e,t=null){const n=this.container,r=this.data,i=this.profile,o=t?t.getAttribute("parentId"):null,s=t?Number(t.getAttribute("id")):null,d=this.move,l=[];let a,c,u,m=this.tree,h=e.target;return function e(t){if(t)return"member"!==t.className?e(t.parentElement):h=t}(h),a=h.getAttribute("id"),c=h.getAttribute("parentId"),u=function e(n){return r.some(r=>{const d=r.parentId;return!!("null"===o&&t.parentElement.parentElement.querySelector(`input[name=${Object.keys(i)[0]}${a}]`)||n===r.id&&n===s)||(n===r.id&&d?e(d):void 0)})}(Number(c)),this._checkNodeOn()||!h||a===s||c===s||u||h!==n&&"member"!==h.className?h.style.background="":(r.forEach(e=>{const t=r.filter(e=>e.parentId===Number(a)).length;e.id!==Number(a)&&e.parentId!==Number(a)&&e.id===Number(s)&&(e.parentId=Number(a),e.sequenceId=t,l.push(e),r.filter(e=>e.parentId===Number(o)).sort((e,t)=>e.sequenceId-t.sequenceId).forEach((e,t)=>{e.sequenceId!==t&&(l.push(e),e.sequenceId=t)}))}),l.length&&d({...l}),m=this._treeModel(r),n.innerHTML="",this.tree=m,this._printTree(m,n),void this._addEvent())}_addEvent(){const e=document.querySelectorAll(".add-btn"),t=document.querySelectorAll(".remove-btn");document.querySelectorAll(`input[name*=${Object.keys(this.profile)[0]}]`).forEach(e=>{e.getAttribute("style")&&e.focus()}),e.forEach(e=>e.addEventListener("click",this._addNode.bind(this))),t.forEach(e=>e.addEventListener("click",this._removeNode.bind(this))),this._saveEvent(),this._modifyEvent()}_saveEvent(){const e=document.querySelectorAll(".save-btn"),t=this.profile,n=this.data;e.forEach(e=>{const r=e.parentElement.querySelectorAll("input");e.addEventListener("click",function(){const i=this.add,o=this.modify,s=Number(e.parentElement.getAttribute("id"));r.forEach(e=>{const n=e.previousElementSibling,r=e.name.replace(/[0-9]/g,"");n.textContent=e.value||t[r],n.removeAttribute("style"),e.removeAttribute("style")}),e.style.display="none",n.forEach(n=>{n.id===s&&(r.forEach(e=>{const r=e.name.replace(/[0-9]/g,"");n[r]=e.value||t[r]}),e.getAttribute("modified")&&o?o(n):i&&i(n))}),e.removeAttribute("modified")}.bind(this))})}_modifyEvent(){const e=document.querySelectorAll(".profile span");this.editable&&e.forEach(e=>{const t=e.parentElement.parentElement,n=t.parentElement.parentElement.querySelector(".save-btn");e.addEventListener("click",function(r){const i=t.querySelectorAll("span"),o=t.querySelectorAll("input");this._checkNodeOn(r.target)||(i.forEach(e=>e.style.display="none"),o.forEach(e=>{e.style.display="block",e.value=e.previousElementSibling.textContent}),e.nextElementSibling.focus(),n.style.display="block",n.setAttribute("modified",!0))}.bind(this))})}_moveEvent(){const e=this._moveNode.bind(this);let t;this.editable&&(container.addEventListener("dragstart",function(e){"move"!==container.style.cursor&&(t=e.target,e.target.style.border="1px solid red")}.bind(this)),container.addEventListener("dragend",(function(e){"move"!==container.style.cursor&&(e.target.style.border="")})),container.addEventListener("dragover",(function(e){e.preventDefault()})),container.addEventListener("dragenter",(function(e){const t=this;"move"!==container.style.cursor&&function e(n){n&&("member"!==n.className?n===t?n.style.background="red":(e(n.parentElement),t.removeAttribute("style")):n.style.background="red")}(e.target)})),container.addEventListener("dragleave",(function(e){"move"!==container.style.cursor&&("member"!==e.target.className&&e.target!==this||e.target.removeAttribute("style"))})),container.addEventListener("drop",(function(n){"move"!==container.style.cursor&&("member"!==n.target.className&&n.target!==this||n.target.removeAttribute("style"),e(n,t),container.style.cursor="default")})))}_zoomEvent(){if(this.useZoom){const e=document.querySelector(".container-wrap");this.container.style.overflow="scroll",e.style.transition="zoom 0.2s ease",e.style.zoom=this.defaultZoom,container.addEventListener("mousewheel",function(t){100===t.deltaY&&this.defaultZoom>.6?this.defaultZoom-=.05:-100===t.deltaY&&this.defaultZoom<this.zoom&&(this.defaultZoom+=.05),e.style.zoom=this.defaultZoom}.bind(this))}}_treeModel(e){const t=JSON.parse(JSON.stringify(e)),n=[],r=(e,n,i)=>{const o=n.parentId;if(e instanceof Array)return e.some(e=>{let s;return e.id===o?(e.children=e.children||[],s=e.children,s.push(t.splice(i,1)[0]),s.sort((e,t)=>e.sequenceId-t.sequenceId)):r(e.children,n,i)})};for(;t.length>0;)t.some((e,i)=>null===e.parentId?n.push(t.splice(i,1)[0]):r(n,e,i));return n}_printTree(e,t,n=!1){if(console.time("test"),console.log(this.data.length),t===container){const e=document.createElement("div");e.className="container-wrap",t.appendChild(e),t=e}e.forEach((r,i)=>{const o=r.parentId,s=r.children,d=document.createElement("div"),l=document.createElement("div"),a=document.createElement("div"),c=document.createElement("div"),u=document.createElement("div"),m=document.createElement("div"),h=document.createElement("div"),p=document.createElement("ul"),f=document.createElement("button"),b=document.createElement("button"),y=document.createElement("button"),v=r.id;d.className="group-column",l.className="line-box",a.className="line",a.classList.add("border-right"),c.className="line",1!==e.length&&(0===i?c.classList.add("border-top"):i===e.length-1?a.classList.add("border-top"):(a.classList.add("border-top"),c.classList.add("border-top"))),u.className="member-box",m.className="member",m.setAttribute("id",r.id),m.setAttribute("parentId",r.parentId),m.setAttribute("sequenceId",r.sequenceId),h.className="profile-box",p.className="profile",this.editable&&(m.draggable=!0,f.className="add-btn",f.innerHTML="&#43;",b.className="remove-btn",b.innerHTML="&#45;",y.className="save-btn",y.innerHTML="&#10003;",y.style.display="none");for(const[e,t]of Object.entries(this.profile)){const i=document.createElement("li"),o=document.createElement("input"),s=document.createElement("span");if(!0===this.usePhoto&&"photo"===e){const n=document.createElement("div"),i=document.createElement("img");i.src=r[e]||t,i.draggable=!1,n.appendChild(i),h.appendChild(n)}else o.type="text",o.name=`${e}${v}`,o.placeholder=e,s.textContent=r[e]||t,n&&v===this.id&&(s.style.display="none",o.style.display="block"),i.appendChild(s),i.appendChild(o),p.appendChild(i)}if(h.appendChild(p),m.appendChild(h),this.editable&&(m.appendChild(f),m.appendChild(b),m.appendChild(y)),u.appendChild(m),l.appendChild(a),l.appendChild(c),n&&v===this.id&&(y.style.display="block"),null!==o&&d.appendChild(l),d.appendChild(u),s){const e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div");e.className="line-box",t.className="line",t.classList.add("border-right"),n.className="line",e.appendChild(t),e.appendChild(n),d.appendChild(e)}if(1===e.length)t.appendChild(d),t=d,s&&this._printTree(s,t,n);else{if(0===i){const e=document.createElement("div");e.className="group-row",e.appendChild(d),t.appendChild(e),t=e}else t.appendChild(d);s&&this._printTree(s,d,n)}}),this._zoomEvent(),console.timeEnd("test")}draw(e,t){const n={id:0,name:"name",parentId:null,sequenceId:0},r=[],i=JSON.parse(JSON.stringify(t));let o,s=JSON.parse(JSON.stringify(e));if(s){const t=[];s=s.sort((e,t)=>e.id-t.id),s.forEach((n,i)=>{const o=n.id,s=n.parentId,d=n.sequenceId,l=e.some(e=>s===e.id);!n.hasOwnProperty("id")||!n.hasOwnProperty("parentId")||!n.hasOwnProperty("sequenceId")||"number"!=typeof o||null!==s&&"number"!=typeof s||"number"!=typeof d||Number.isNaN(o)||Number.isNaN(s)||Number.isNaN(d)||o===s||i!==e.length-1&&e[i].id===e[++i].id||null!==s&&!l?r.push(n):t.push(n)}),s=t,s.length||(s=[n])}else s=[n];e&&s.length!==e.length&&console.warn("[OrgChart] Warning: Some data items have invalid values or do not have required properties. They were excluded. You'd better check the data."),this.usePhoto=i.usePhoto,this.profile=i.profile||{name:"name"},this.useZoom=i.useZoom||!1,this.zoom=i.zoom||i.zoom>3?3:i.zoom,this.editable=i.editable||!1,this.data=s,o=this._treeModel(s),this.tree=o,this._printTree(o,container),this.id=s[s.length-1].id,this.excludedData=r,this._addEvent(),this._moveEvent()}add(e){this.add=e}remove(e){this.remove=e}modify(e){this.modify=e}move(e){this.move=e}getExcludedData(){return this.excludedData}}}]).default}));